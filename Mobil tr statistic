
select t.servicename, to_char(tarix,'Mon') as ay,sum("3-uzeri") as "3-uzeri",count("3-uzeri") "3-uzeri tr say",
sum("5-uzeri") as "5-uzeri",count("5-uzeri") "5-uzeri tr say" from (
select s.servicename,cast(paydate as date) as tarix,agentpaymentid,
case when paysum>3 then paysum end as "3-uzeri",
case when paysum>5 then paysum end as "5-uzeri" from gate.payment p
join service s on p.serviceid =s.serviceid and 
paydate between '2022-04-01' and '2022-07-01' and status=2 and p.serviceid in (543,163,694,695)) as t 
group by t.servicename,to_char(tarix,'Mon') order by to_char(tarix,'Mon')
