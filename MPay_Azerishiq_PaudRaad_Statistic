with cte as (
select id_service,"name", "Status",count(id_operation) as say from (
select  m.id_service ,s."name" ,id_operation,case when state =60 then 'ugurlu' when state=80 then 'ugursuz' when state=40 then'novbede' end as "Status"
from operations.master m join public.services s on m.id_service =s.id_service  where m.id_service in (1617,1618) and 
time_server between '2022-06-23 14:00' and now()   
and  id_point  in (4744,5676,4219,5747,5809,4613,5087,5691,5213,5941,4036,5895,5509,5521,5546,5518,5520,5504,5507,4818,5824,5624,3596,5699,5613,5754,5623,5792,5914,5942,4726,5828,5116,5041,5133,5964,5866,5622,5527,3779,4797,4692,5917,5400,4939,4934,4915,5915,5401,5679,5963,5923,5816,4745,5870,4610,5924,5859,5940,5959,5812,5153,5913,5508,5965,4805,4968,5169,4967,5811,
5473,5398,5961,5627,5797,5817,5616,5375,4241,5537,5918,5832,5140,5920,3850,5821,5958,4761,5698,4798,5903,5284,5090,5171,5801,5408,5950,5247,5450,5905,5892,4738,5516,4356,3458,5542,5229,5540,5956,5957,5456,5093,5572,5461,5894,5411,5909,5744,5562,
5960,5513,5310,4804,5605,5089,5962,5678,5675,5244,5743,5162,5929,5938,5931,5458,5615,5760,5887,4839,4813,5943,5949,5138,5937,4723,5944,5936,5945,5558,5939,5864,4676,5248,5863,5363,5464,5947,5560,5946,5129,5951,5137,4944,5559,5553,4734,5466,5611,5474,5865,5538,5867,
5220,5948,5625,5515,5447,5161,5604,5387,4512,5130,4667,3571,3150,3643,3239,5301,3989,5910,4671,4675,4673,5325,5984,5127,5738,4066,5510,4700,4663,4580,4707,5933,5299)
) t group by id_service,"name", "Status"  ) select cast(id_service as varchar),"name", "Status",say from cte 
union all 
(select 'Umumi',null,null,sum(say) from cte)
