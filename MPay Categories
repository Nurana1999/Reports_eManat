
select b."Kategoriya",sum(a."sum_income"),count(a.id_operation) from 
(select id_operation,id_service,sum_income/100 "sum_income" from operations.master m where  m.id_point <>8 and 
m.time_process >='2022-04-01'
and m.time_process <'2022-05-01'
and m.time_server >=date'2022-04-01'-interval '7 day'
and m.time_server <date'2022-05-01'+interval '7 day' 
and state=60 and substate=0) a
join 
(select case when s.id_service in (733,734,735,736,809,818,819,912,1032,1033,1034,1587,1605,976,311,310,312,313,314,315,118,119,120,1013,1014,1015,1016,1045,1046,1047,1048,1049,1050,1051,
1439,1440,1441,1442,1443,1444,1035,1018,134,837,959,973,844,983,1479,415,135,136,416,297,329,334,
366,436,437,443,494,504,545,577,570,573,594,607,611,616,617,682,707,708,711,756,778,781,842,849,904,
970,971,972,974,981,982,1044,1455,1457,1458,1459,1464,1465,1466,1471,1475,1476,1477,1478,1480,1481,
1485,1533,1534,1535,1536,1537,1538,1539,1540,1541,1542,1543,1544,1545,1546,1547,1548,1549,1550,1551,
1554,1558,1579,1580,1581,1583,1584,1588,1601,1602,1621,429,430,431,432,438,439,440,1017,788,628,629,
433,434,435,445,446,447,448,449,450,451,452,453,454,455,386,383,384,385,362,363,364,365,294,
295,296,298,299,300,301,302,303,304,306,308,309,271,272,273,274,275,276,157,158,159,160,164,444,
305,307,411,412,410,645,63,199,200,322,646,713,720,727,728,441)
then 'Bank'
when s.id_service  in (388,389,390,419,589,14721473,1474,678,3,6,16,1472,1473)
then 'Mobil'
when s.id_service  in (696,12,320,426,467,413,414,4,43,44,45,46,47,48,49,74,79,83,84,86,87,93,1021,59,907,839,935,1491,
908,909,910,911,995,996,975,15,64,96,97,14,151,640,622,94,101,131,144,155,161,232,323,341,418,382,391,471,499,505,507,510,517,520,574,575,600,679,683,686,687,689,
691,698,724,732,737,738,745,791,796,843,857,858,900,985,986,1024,1026,1028,1448,1454,1486,1487,1488,1489,1490,1501,1569,1570,1571,1572,1573,1592,1593,1594,1606,1613,1616,1620)
then 'Internet'
when s.id_service  in (988,989,990,156,100,125,165,357,358,359,360,361,516,610,653,695,861,960,987,790)
then 'Xeyriyye'
when s.id_service  in (817,821,824,847,848,984,335,17,18,19,20,21,22,23,24,25,26,27,28,29,30,1586,1595,
1596,1597,1598,1599,1600,352,558,559,560,561,562,563,564,565,566,567,739,740,741,742,743,672,
673,674,675,676,604,605,618,619,541,519,521,522,529,530,468,469,470,393,394,395,397,424,344,
345,346,348,349,350,351,353,355,356,354,396,347,326,71,425,70,317,318,332,333,338,492,703,704,325)
then 'Belediyye'
when s.id_service  in (1042,80,977,1008,1009,1619,1020,111,107,495,496,630,631,992,968,969,991,216,218,224,228,252,257,261,267,259,260,854)
then 'neqliyyat'
when s.id_service  in (852,1474,680,681,369,105,207,417,370,702,759,782,783,789,792,793,905,966,1582,1590,367,368,330,
331,758,994)
then 'sigorta'
when s.id_service  in (1482,1552,1576,1624,1615,253,254,255,234,241,242,251,666)
then 'seyahet turizm'
when s.id_service  in (697,526,527,400,710,
401,402,403,404,405,408,409,398,
699,700,744,9,406,407,840,7,8,10,11,13,61,65,66,67,68,69,288,797,798,800,801,802,803,807,899,901,902,903,980,997,1460,1461,1462,1463,1468,1469,1502,1603,
1446,1447,1575,1011,1012,1617,1618)
then 'Kommunal'
when s.id_service  in (31,50,32,33,35,34,36,37,804,746,688,690,701,153,154,132,693,993)
then 'Telefon'
when s.id_service  in (760,772,773,730,731)
then 'Odeme kartlari'
when s.id_service  in (2,51,747,750,692,373,152,145,146,122,374,
375,491,506,508,512,342,324,319,321,576,511)
then 'TV'
when s.id_service  in (1003,1004,1005,1006,1007,1614,89,
603,123,133,231,523,524,525,572,621,632,633,634,670,671,694,777,1565,1625,465,
472,540,795,906,913,915,916,1484,1557,1562,1563,1564,914,1019,612,
613,614,615)
then 'Tehsil'
when s.id_service  in (1040,1041,1038,1039,1036,1037,40,751,466,39,42,60,72,75,85,99,124,171,173,185,202,427,
460,464,528,542,546,568,620,643,648,656,677,715,721,752,808,841,864,961,962,963,964,965,1025,1029,
1043,1456,1470,1504,1505,1506,1507,1508,1512,1513,1514,1515,1516,1517,1518,1519,1520,1521,1522,1523,
1524,1525,1526,1527,1528,1529,1530,1531,1532,1623,1002,137,140,141,142,143,1556,1561,1604,498,138,139,387,1566)
then 'magaza e-ticaret'
when s.id_service  in (814,88,162,268,284,458,459,579,810,811,812,813,816,820,822,823,825,826,827,828,829,
830,831,832,833,834,835,836,838,865,967,1,027,1030,1031,
863,62,794,1483,1500,639,543,544,41,52,53,54,55,56,57,58,978,866,213,184,
225,240,243,815,601,501,502,998,1493,186,187,197,230,503,712,779,784,785,787,999,1001,1010,1492,1496,1577,163,
256,1567,1568,786,1578,198,204,206,208,210,211,212,214,215,217,219,222,227,229,244,248,250,258,262,
263,264,265,266,203,205,209,220,221,223,226,233,235,236,237,238,239
)
then 'e-pul'
when s.id_service  in (853,201,126,127,392,399,626,627,647,1022,532,147,552,
1553,1559,1560,845,805,806,1445,658,659,660,661,662,663,664,665,534,535,536,537,538,539,473,
474,475,476,477,478,479,377,378,379,380,381,420,421,422,423,98,110,112,637,636,269,549,
550,551,553,554,555,557,592,635,638,1574,979,1622,1607,1608,1609,1610,1611,195,1555,1495,1497,1498,1499,1503,1509,1510)
then 'Diger'
else 
'Eylence-oyun'
end as "Kategoriya",
s.id_service "ServiceID",name 
from public.services s
) b on a.id_service=b."ServiceID"
group by  b."Kategoriya"
